(this.webpackJsonpbilderbox=this.webpackJsonpbilderbox||[]).push([[0],{84:function(t,e,s){"use strict";s.r(e);var i=s(0),n=s(30),a=s(109),c=s(110),o=s(64),r=s(65);const h=Object(r.a)({palette:{primary:{main:"#fbc02d"},secondary:{main:"#ffab00"}}});var d=s(104),l=s(112),u=s(105),m=s(106),p=s(107),j=s(111),g=s(3);const b=Object(d.a)((()=>({grow:{flexGrow:1}}))),v=()=>{const t=b();return Object(g.jsx)(l.a,{position:"fixed",children:Object(g.jsxs)(u.a,{children:[Object(g.jsx)(m.a,{children:Object(g.jsx)(j.a,{})}),Object(g.jsx)(p.a,{variant:"h6",noWrap:!0,children:"BilderboX"}),Object(g.jsx)("div",{className:t.grow})]})})};var f=s(6);const I=()=>Object(g.jsx)(g.Fragment,{children:[...Array(100)].map((t=>Object(g.jsx)(p.a,{children:"Hello World!"},t)))});var w=s(32),x=s(63);const O="localhost"===window.location.hostname?"https://localhost:3000/":"https://jakobnohe.de/bilderbox/";class y{constructor(){this.msalConfig={auth:{clientId:"df346ab3-6ba2-4c7a-a4b6-96986093b576",redirectUri:O},cache:{cacheLocation:"localStorage"}},this.scopes=["User.Read","Files.ReadWrite.All","offline_access"],this.application=new x.a(this.msalConfig),this.authenticate=async()=>{if(!await this.isAuthenticated())if(window.location.hash.startsWith("#code=")){if(!await this.application.handleRedirectPromise())throw new Error("Failed to authenticate, result ist NULL")}else this.application.loginRedirect({scopes:this.scopes})},this.isAuthenticated=async()=>{try{return await this.application.acquireTokenSilent({account:this.application.getAllAccounts()[0],scopes:this.scopes}),!0}catch(t){return!1}},this.getAccessToken=async()=>{try{return(await this.application.acquireTokenSilent({account:this.application.getAllAccounts()[0],scopes:this.scopes})).accessToken}catch(t){throw new Error("Failed to get access token, try sign-in again.")}},this.logout=async()=>{await this.application.logout()}}}const F=()=>{const{path:t}=Object(f.f)(),[e,s]=i.useState();return i.useEffect((()=>{(async()=>{const e=new y,i=w.a.initWithMiddleware({authProvider:{getAccessToken:e.getAccessToken}}),n=await i.api(t).get();s(n)})()}),[t]),Object(g.jsx)("pre",{children:JSON.stringify(e,void 0,2)})};var T=s(108),A=s(113);const k=new y,P=w.a.initWithMiddleware({authProvider:{getAccessToken:k.getAccessToken}});class R{constructor(t){this.pendingItems=[],this.foundItems=[],this.ownerDriveId=void 0,this.status=void 0,this.start=async t=>{const e=await this.graphGet("/me/drive/root/children");this.pendingItems.push(...e.value);for(let s=0;s<t;s++)setTimeout((()=>{this.fetchItem()}),0)},this.getResult=async()=>(await this.waitForCompletion(),this.foundItems.map((t=>{var e;return{id:`${this.getDriveId(t)}/${this.getItemId(t)}`,name:t.name,size:t.size,path:`${null===(e=t.parentReference)||void 0===e?void 0:e.path}/${t.name}`}}))),this.waitForCompletion=()=>new Promise((t=>{const e=setInterval((()=>{this.foundItems.length>0&&0===this.pendingItems.length&&(clearInterval(e),t())}),100)})),this.fetchItem=async()=>{if(this.status&&this.status(this.foundItems.length,this.pendingItems.length),this.foundItems.length>100)return void(this.pendingItems=[]);const t=this.pendingItems.shift();if(t){const e=this.getItemPath(t),s=await this.graphGet(`${e}`);if(s.folder){const t=await this.graphGet(`${e}/children`);this.pendingItems.push(...t.value)}else s.file?this.foundItems.push(s):console.error("Found an unknown item.",s);await this.fetchItem()}},this.getDriveId=t=>{var e,s,i,n,a;return(null===(e=t.remoteItem)||void 0===e||null===(s=e.parentReference)||void 0===s?void 0:s.driveId)?null===(i=t.remoteItem)||void 0===i||null===(n=i.parentReference)||void 0===n?void 0:n.driveId:null===(a=t.parentReference)||void 0===a?void 0:a.driveId},this.getItemId=t=>{var e,s;return(null===(e=t.remoteItem)||void 0===e?void 0:e.id)?null===(s=t.remoteItem)||void 0===s?void 0:s.id:t.id},this.getItemPath=t=>`/drives/${this.getDriveId(t)}/items/${this.getItemId(t)}`,this.graphGet=async t=>await P.api(t).get(),this.ownerDriveId=t.ownerDriveId,this.status=t.status}}const S=new y,$=w.a.initWithMiddleware({authProvider:{getAccessToken:S.getAccessToken}});class C{constructor(){this.listAllFiles=async t=>{const e=await this.graphGet("/me/drive"),s=new R({ownerDriveId:e.id,status:t});return s.start(10),await s.getResult()},this.graphGet=async t=>await $.api(t).get()}}const D=()=>{const[t,e]=i.useState({fetchedItems:0,itemsToFetch:0}),[s,n]=i.useState(!1),[a,c]=i.useState([]);return i.useEffect((()=>{(async()=>{if(s){const t=new C,s=await t.listAllFiles(((t,s)=>{e({fetchedItems:t,itemsToFetch:s})}));c(s),n(!1)}})()}),[s]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(p.a,{variant:"h1",children:"Photos"}),!s&&0===a.length&&Object(g.jsx)(T.a,{onClick:()=>n(!0),variant:"contained",color:"primary",children:"Load Photos"}),s&&Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(G,{fetchedItems:t.fetchedItems,itemsToFetch:t.itemsToFetch})}),Object(g.jsx)("pre",{children:a.length>0&&JSON.stringify(a,void 0,2)})]})},G=t=>{const e=0===t.fetchedItems&&0===t.itemsToFetch?0:t.fetchedItems/(t.fetchedItems+t.itemsToFetch);return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(A.a,{variant:"determinate",value:e}),Object(g.jsxs)(p.a,{variant:"caption",children:[`${Math.round(e)}%`," (",t.fetchedItems," found, ",t.itemsToFetch," to be analyzed)"]})]})},L=Object(d.a)((t=>({content:{marginTop:"60px",padding:t.spacing(2)}}))),W=()=>{const t=L();return Object(g.jsx)("div",{className:t.content,children:Object(g.jsxs)(f.c,{children:[Object(g.jsx)(f.a,{path:"/photos",children:Object(g.jsx)(D,{})}),Object(g.jsx)(f.a,{path:"/test/:path+",children:Object(g.jsx)(F,{})}),Object(g.jsx)(f.a,{path:"/",children:Object(g.jsx)(I,{})})]})})},E=()=>{const t=new URL(O).pathname;return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(a.a,{}),Object(g.jsx)(c.a,{theme:h,children:Object(g.jsxs)(o.a,{basename:t,children:[Object(g.jsx)(v,{}),Object(g.jsx)(W,{})]})})]})};(async()=>{const t=new y;var e;await t.authenticate(),n.render(Object(g.jsx)(i.StrictMode,{children:Object(g.jsx)(E,{})}),document.getElementById("root")),e&&e instanceof Function&&s.e(3).then(s.bind(null,114)).then((({getCLS:t,getFID:s,getFCP:i,getLCP:n,getTTFB:a})=>{t(e),s(e),i(e),n(e),a(e)}))})()}},[[84,1,2]]]);
//# sourceMappingURL=main.c0507dda.chunk.js.map