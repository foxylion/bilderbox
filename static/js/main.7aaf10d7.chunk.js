(this.webpackJsonpbilderbox=this.webpackJsonpbilderbox||[]).push([[0],{89:function(t,e,s){"use strict";s.r(e);var i=s(0),n=s(30),a=s(114),c=s(115),r=s(69),o=s(70);const h=Object(o.a)({palette:{primary:{main:"#fbc02d"},secondary:{main:"#ffab00"}}});var l=s(109),d=s(117),m=s(110),u=s(111),j=s(112),p=s(116),g=s(3);const b=Object(l.a)((()=>({grow:{flexGrow:1}}))),I=()=>{const t=b();return Object(g.jsx)(d.a,{position:"fixed",children:Object(g.jsxs)(m.a,{children:[Object(g.jsx)(u.a,{children:Object(g.jsx)(p.a,{})}),Object(g.jsx)(j.a,{variant:"h6",noWrap:!0,children:"BilderboX"}),Object(g.jsx)("div",{className:t.grow})]})})};var f=s(6);const v=()=>Object(g.jsx)(g.Fragment,{children:[...Array(100)].map((t=>Object(g.jsx)(j.a,{children:"Hello World!"},t)))});var w=s(35),O=s(68);const x="localhost"===window.location.hostname?"https://localhost:3000/":"https://jakobnohe.de/bilderbox/";class F{constructor(){this.msalConfig={auth:{clientId:"df346ab3-6ba2-4c7a-a4b6-96986093b576",redirectUri:x},cache:{cacheLocation:"localStorage"}},this.scopes=["User.Read","Files.ReadWrite.All","offline_access"],this.application=new O.a(this.msalConfig),this.authenticate=async()=>{if(!await this.isAuthenticated())if(window.location.hash.startsWith("#code=")){if(!await this.application.handleRedirectPromise())throw new Error("Failed to authenticate, result ist NULL")}else this.application.acquireTokenRedirect({scopes:this.scopes})},this.isAuthenticated=async()=>{try{return await this.application.acquireTokenSilent({account:this.application.getAllAccounts()[0],scopes:this.scopes}),!0}catch(t){return!1}},this.getAccessToken=async()=>{try{return(await this.application.acquireTokenSilent({account:this.application.getAllAccounts()[0],scopes:this.scopes})).accessToken}catch(t){throw new Error("Failed to get access token, try sign-in again.")}},this.logout=async()=>{await this.application.logout()}}}const y=()=>{const{path:t}=Object(f.f)(),[e,s]=i.useState();return i.useEffect((()=>{(async()=>{const e=new F,i=w.a.initWithMiddleware({authProvider:{getAccessToken:e.getAccessToken}}),n=await i.api(t).get();s(n)})()}),[t]),Object(g.jsx)("pre",{children:JSON.stringify(e,void 0,2)})};var T=s(113),A=s(118),k=s(49);const P=new F,$=w.a.initWithMiddleware({authProvider:{getAccessToken:P.getAccessToken}});class R{constructor(t){this.pendingItems=[],this.foundItems=[],this.status=void 0,this.start=async t=>{const e=await this.graphGet("/me/drive/root/children");this.pendingItems.push(...e.value);for(let s=0;s<t;s++)setTimeout((()=>{this.fetchItem()}),0)},this.getResult=async()=>(await this.waitForCompletion(),this.foundItems.map((t=>{var e;return{id:`${this.getDriveId(t)}:${this.getItemId(t)}`,name:t.name,size:t.size,path:`${null===(e=t.parentReference)||void 0===e?void 0:e.path}/${t.name}`}}))),this.waitForCompletion=()=>new Promise((t=>{const e=setInterval((()=>{this.foundItems.length>0&&0===this.pendingItems.length&&(clearInterval(e),t())}),100)})),this.fetchItem=async()=>{let t=this.pendingItems.shift();for(;t;){if(t.folder){const e=await Object(k.a)(`children:${this.getDriveId(t)}:${this.getItemId(t)}`);if(e)this.pendingItems.push(...e);else{const e=await this.fetchAllChildren(t);await Object(k.b)(`children:${this.getDriveId(t)}:${this.getItemId(t)}`,e),this.pendingItems.push(...e)}}else if(t.remoteItem){const e=await this.graphGet(this.getItemPath(t));this.pendingItems.push(e)}else t.file?this.foundItems.push(t):console.error("Found an unknown item.",t);t=this.pendingItems.shift(),this.status&&this.status(this.foundItems.length,this.pendingItems.length)}},this.fetchAllChildren=async t=>{const e=[],s=this.getItemPath(t),i=await this.graphGet(`${s}/children`),n=new w.b($,i,(t=>(e.push(t),!0)));return await n.iterate(),e},this.getDriveId=t=>{var e,s,i,n,a;return(null===(e=t.remoteItem)||void 0===e||null===(s=e.parentReference)||void 0===s?void 0:s.driveId)?null===(i=t.remoteItem)||void 0===i||null===(n=i.parentReference)||void 0===n?void 0:n.driveId:null===(a=t.parentReference)||void 0===a?void 0:a.driveId},this.getItemId=t=>{var e,s;return(null===(e=t.remoteItem)||void 0===e?void 0:e.id)?null===(s=t.remoteItem)||void 0===s?void 0:s.id:t.id},this.getItemPath=t=>`/drives/${this.getDriveId(t)}/items/${this.getItemId(t)}`,this.graphGet=async t=>await $.api(t).get(),this.status=t.status}}class C{constructor(){this.listAllFiles=async t=>{const e=new R({status:t});return e.start(5),await e.getResult()}}}const S=()=>{const[t,e]=i.useState({fetchedItems:0,itemsToFetch:0}),[s,n]=i.useState(!1),[a,c]=i.useState([]);return i.useEffect((()=>{(async()=>{if(s){const t=new C,s=await t.listAllFiles(((t,s)=>{e({fetchedItems:t,itemsToFetch:s})}));c(s),n(!1)}})()}),[s]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(j.a,{variant:"h1",children:"Photos"}),!s&&0===a.length&&Object(g.jsx)(T.a,{onClick:()=>n(!0),variant:"contained",color:"primary",children:"Load Photos"}),s&&Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(L,{fetchedItems:t.fetchedItems,itemsToFetch:t.itemsToFetch})}),a.length>0&&Object(g.jsx)(g.Fragment,{children:Object(g.jsx)("ul",{children:Object(g.jsxs)("li",{children:["Found Photos: ",a.length]})})})]})},L=t=>{const e=100*(0===t.fetchedItems&&0===t.itemsToFetch?0:t.fetchedItems/(t.fetchedItems+t.itemsToFetch));return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(A.a,{variant:"determinate",value:e}),Object(g.jsxs)(j.a,{variant:"caption",children:[`${Math.round(e)}%`," (",t.fetchedItems," found, ",t.itemsToFetch," to be analyzed)"]})]})},D=Object(l.a)((t=>({content:{marginTop:"60px",padding:t.spacing(2)}}))),W=()=>{const t=D();return Object(g.jsx)("div",{className:t.content,children:Object(g.jsxs)(f.c,{children:[Object(g.jsx)(f.a,{path:"/photos",children:Object(g.jsx)(S,{})}),Object(g.jsx)(f.a,{path:"/test/:path+",children:Object(g.jsx)(y,{})}),Object(g.jsx)(f.a,{path:"/",children:Object(g.jsx)(v,{})})]})})},E=()=>{const t=new URL(x).pathname;return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(a.a,{}),Object(g.jsx)(c.a,{theme:h,children:Object(g.jsxs)(r.a,{basename:t,children:[Object(g.jsx)(I,{}),Object(g.jsx)(W,{})]})})]})};(async()=>{const t=new F;var e;await t.authenticate(),n.render(Object(g.jsx)(i.StrictMode,{children:Object(g.jsx)(E,{})}),document.getElementById("root")),e&&e instanceof Function&&s.e(3).then(s.bind(null,119)).then((({getCLS:t,getFID:s,getFCP:i,getLCP:n,getTTFB:a})=>{t(e),s(e),i(e),n(e),a(e)}))})()}},[[89,1,2]]]);
//# sourceMappingURL=main.7aaf10d7.chunk.js.map